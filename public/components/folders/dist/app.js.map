{"version":3,"sources":["app.js"],"names":["_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","Constructor","protoProps","staticProps","prototype","_classCallCheck","instance","TypeError","ComponentManager","permissions","onReady","sentMessages","messageQueue","loggingEnabled","acceptsThemes","activeThemes","initialPermissions","onReadyCallback","coallesedSaving","coallesedSavingDelay","registerMessageHandler","value","_this","messageHandler","event","mobileSource","console","log","data","origin","JSON","parse","handleMessage","document","addEventListener","window","payload","action","sessionKey","componentData","activateThemes","themes","original","originalMessage","filter","message","messageId","alert","callback","requestPermissions","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_iterator","Symbol","iterator","_step","next","done","postMessage","err","return","environment","platform","uuid","activeThemeUrls","getSelfComponentUUID","isRunningInDesktopApplication","setComponentDataValueForKey","clearComponentData","componentDataValueForKey","push","generateUUID","api","sentMessage","stringify","parent","setSize","type","width","height","bind","streamItems","contentTypes","Array","isArray","content_types","items","streamContextItem","item","selectItem","jsonObjectForItem","createItem","associateItem","createItems","_this2","mapped","map","deassociateItem","clearSelection","content_type","deleteItem","deleteItems","params","sendCustomEvent","saveItem","skipDebouncer","arguments","saveItems","saveItemWithPresave","presave","saveItemsWithPresave","_this3","saveBlock","mappedItems","updated_at","Date","pendingSave","clearTimeout","setTimeout","copy","assign","children","getItemAppDataValue","AppDomain","content","appData","incomingUrls","sort","toString","themesToActivate","themesToDeactivate","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_iterator2","_step2","activeUrl","includes","candidate","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_iterator3","_step3","theme","deactivateTheme","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_iterator4","_step4","url","link","createElement","id","btoa","href","rel","media","className","getElementsByTagName","appendChild","themeElementForUrl","elements","from","getElementsByClassName","slice","find","element","disabled","parentNode","removeChild","crypto","msCrypto","buf","Uint32Array","getRandomValues","idx","replace","c","r","v","d","getTime","performance","now","Math","random","floor","module","exports","angular","HomeCtrl","$rootScope","$scope","$timeout","smartTagContentType","componentManager","delimiter","resolveRawTags","masterTag","sortTags","tags","a","b","title","resolved","rawTags","findResolvedTag","tag","pendingDummy","dummy","unshift","name","comps","split","displayTitle","getParent","depth","parentTitle","join","tagTitle","index","indexOf","splice","selectedTag","setSelectedForTag","changeParent","sourceId","targetId","source","needsSave","adjustChildren","child","newTitle","master","createTag","startsWith","components","substring","e","smartTag","predicate","keypath","operator","createdTag","selectOnLoad","selectTag","multiSelect","isSmartTag","clearMultipleTagsSelection","multipleTags","smartMaster","createEphemeralSmartTagForMultiTags","editing","tagNames","toggleCollapse","clientData","collapsed","saveTags","selected","newTags","allTags","smartTags","smartMasterTag","arrayToUse","existing","tagCandidate","deleted","deleteTag","deleteChain","addChildren","$$ngIsClass","controller","directive","restrict","scope","shouldFocus","$element","focus","tagId","drop","isDraggable","isDroppable","attrs","el","draggable","counter","dataTransfer","effectAllowed","setData","classList","add","remove","dropEffect","preventDefault","stopPropagation","getData","$apply","TagTree","templateUrl","onSelect","onToggleCollapse","onDrop","onDragOver","onDragStart","ctrlKey","metaKey","addChild","$event","addingTag","saveNewTag","removeTag","innerCollapse","saveTagRename","renameChildren","generationForTag","generation","circleClassForTag","gen","circleClass"],"mappings":"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","file":"app.js","sourcesContent":["\"use strict\";\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar ComponentManager = function () {\n  function ComponentManager(permissions, onReady) {\n    _classCallCheck(this, ComponentManager);\n\n    this.sentMessages = [];\n    this.messageQueue = [];\n    this.loggingEnabled = false;\n    this.acceptsThemes = true;\n    this.activeThemes = [];\n\n    this.initialPermissions = permissions;\n    this.onReadyCallback = onReady;\n\n    this.coallesedSaving = true;\n    this.coallesedSavingDelay = 250;\n\n    this.registerMessageHandler();\n  }\n\n  _createClass(ComponentManager, [{\n    key: \"registerMessageHandler\",\n    value: function registerMessageHandler() {\n      var _this = this;\n\n      var messageHandler = function messageHandler(event, mobileSource) {\n        if (_this.loggingEnabled) {\n          console.log(\"Components API Message received:\", event.data, \"mobile?\", mobileSource);\n        }\n\n        // The first message will be the most reliable one, so we won't change it after any subsequent events,\n        // in case you receive an event from another window.\n        if (!_this.origin) {\n          _this.origin = event.origin;\n        }\n        _this.mobileSource = mobileSource;\n        // If from mobile app, JSON needs to be used.\n        var data = mobileSource ? JSON.parse(event.data) : event.data;\n        _this.handleMessage(data);\n      };\n\n      // Mobile (React Native) uses `document`, web/desktop uses `window`.addEventListener\n      // for postMessage API to work properly.\n\n      document.addEventListener(\"message\", function (event) {\n        messageHandler(event, true);\n      }, false);\n\n      window.addEventListener(\"message\", function (event) {\n        messageHandler(event, false);\n      }, false);\n    }\n  }, {\n    key: \"handleMessage\",\n    value: function handleMessage(payload) {\n      if (payload.action === \"component-registered\") {\n        this.sessionKey = payload.sessionKey;\n        this.componentData = payload.componentData;\n\n        this.onReady(payload.data);\n\n        if (this.loggingEnabled) {\n          console.log(\"Component successfully registered with payload:\", payload);\n        }\n      } else if (payload.action === \"themes\") {\n        if (this.acceptsThemes) {\n          this.activateThemes(payload.data.themes);\n        }\n      } else if (payload.original) {\n        // get callback from queue\n        var originalMessage = this.sentMessages.filter(function (message) {\n          return message.messageId === payload.original.messageId;\n        })[0];\n\n        if (!originalMessage) {\n          // Connection must have been reset. Alert the user.\n          alert(\"This extension is attempting to communicate with Standard Notes, but an error is preventing it from doing so. Please restart this extension and try again.\");\n        }\n\n        if (originalMessage.callback) {\n          originalMessage.callback(payload.data);\n        }\n      }\n    }\n  }, {\n    key: \"onReady\",\n    value: function onReady(data) {\n      if (this.initialPermissions && this.initialPermissions.length > 0) {\n        this.requestPermissions(this.initialPermissions);\n      }\n\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = this.messageQueue[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var message = _step.value;\n\n          this.postMessage(message.action, message.data, message.callback);\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      this.messageQueue = [];\n      this.environment = data.environment;\n      this.platform = data.platform;\n      this.uuid = data.uuid;\n\n      if (this.loggingEnabled) {\n        console.log(\"onReadyData\", data);\n      }\n\n      this.activateThemes(data.activeThemeUrls || []);\n\n      if (this.onReadyCallback) {\n        this.onReadyCallback();\n      }\n    }\n  }, {\n    key: \"getSelfComponentUUID\",\n    value: function getSelfComponentUUID() {\n      return this.uuid;\n    }\n  }, {\n    key: \"isRunningInDesktopApplication\",\n    value: function isRunningInDesktopApplication() {\n      return this.environment === \"desktop\";\n    }\n  }, {\n    key: \"setComponentDataValueForKey\",\n    value: function setComponentDataValueForKey(key, value) {\n      this.componentData[key] = value;\n      this.postMessage(\"set-component-data\", { componentData: this.componentData }, function (data) {});\n    }\n  }, {\n    key: \"clearComponentData\",\n    value: function clearComponentData() {\n      this.componentData = {};\n      this.postMessage(\"set-component-data\", { componentData: this.componentData }, function (data) {});\n    }\n  }, {\n    key: \"componentDataValueForKey\",\n    value: function componentDataValueForKey(key) {\n      return this.componentData[key];\n    }\n  }, {\n    key: \"postMessage\",\n    value: function postMessage(action, data, callback) {\n      if (!this.sessionKey) {\n        this.messageQueue.push({\n          action: action,\n          data: data,\n          callback: callback\n        });\n        return;\n      }\n\n      var message = {\n        action: action,\n        data: data,\n        messageId: this.generateUUID(),\n        sessionKey: this.sessionKey,\n        api: \"component\"\n      };\n\n      var sentMessage = JSON.parse(JSON.stringify(message));\n      sentMessage.callback = callback;\n      this.sentMessages.push(sentMessage);\n\n      // Mobile (React Native) requires a string for the postMessage API.\n      if (this.mobileSource) {\n        message = JSON.stringify(message);\n      }\n\n      if (this.loggingEnabled) {\n        console.log(\"Posting message:\", message);\n      }\n\n      window.parent.postMessage(message, this.origin);\n    }\n  }, {\n    key: \"setSize\",\n    value: function setSize(type, width, height) {\n      this.postMessage(\"set-size\", { type: type, width: width, height: height }, function (data) {});\n    }\n  }, {\n    key: \"requestPermissions\",\n    value: function requestPermissions(permissions, callback) {\n      this.postMessage(\"request-permissions\", { permissions: permissions }, function (data) {\n        callback && callback();\n      }.bind(this));\n    }\n  }, {\n    key: \"streamItems\",\n    value: function streamItems(contentTypes, callback) {\n      if (!Array.isArray(contentTypes)) {\n        contentTypes = [contentTypes];\n      }\n      this.postMessage(\"stream-items\", { content_types: contentTypes }, function (data) {\n        callback(data.items);\n      }.bind(this));\n    }\n  }, {\n    key: \"streamContextItem\",\n    value: function streamContextItem(callback) {\n      this.postMessage(\"stream-context-item\", null, function (data) {\n        var item = data.item;\n        /*\n          When an item is saved via saveItem, its updated_at value is set client side to the current date.\n          If we make a change locally, then for whatever reason receive an item via streamItems/streamContextItem,\n          we want to ignore that change if it was made prior to the latest change we've made.\n           Update 1/22/18: However, if a user is restoring a note from version history, this change\n          will not pass through this filter and will thus be ignored. Because the client now handles\n          this case with isMetadataUpdate, we no longer need the below.\n        */\n        // if(this.streamedContextItem && this.streamedContextItem.uuid == item.uuid\n        //   && this.streamedContextItem.updated_at > item.updated_at) {\n        //   return;\n        // }\n        // this.streamedContextItem = item;\n        callback(item);\n      });\n    }\n  }, {\n    key: \"selectItem\",\n    value: function selectItem(item) {\n      this.postMessage(\"select-item\", { item: this.jsonObjectForItem(item) });\n    }\n  }, {\n    key: \"createItem\",\n    value: function createItem(item, callback) {\n      this.postMessage(\"create-item\", { item: this.jsonObjectForItem(item) }, function (data) {\n        var item = data.item;\n\n        // A previous version of the SN app had an issue where the item in the reply to create-item\n        // would be nested inside \"items\" and not \"item\". So handle both cases here.\n        if (!item && data.items && data.items.length > 0) {\n          item = data.items[0];\n        }\n\n        this.associateItem(item);\n        callback && callback(item);\n      }.bind(this));\n    }\n  }, {\n    key: \"createItems\",\n    value: function createItems(items, callback) {\n      var _this2 = this;\n\n      var mapped = items.map(function (item) {\n        return _this2.jsonObjectForItem(item);\n      });\n      this.postMessage(\"create-items\", { items: mapped }, function (data) {\n        callback && callback(data.items);\n      }.bind(this));\n    }\n  }, {\n    key: \"associateItem\",\n    value: function associateItem(item) {\n      this.postMessage(\"associate-item\", { item: this.jsonObjectForItem(item) });\n    }\n  }, {\n    key: \"deassociateItem\",\n    value: function deassociateItem(item) {\n      this.postMessage(\"deassociate-item\", { item: this.jsonObjectForItem(item) });\n    }\n  }, {\n    key: \"clearSelection\",\n    value: function clearSelection() {\n      this.postMessage(\"clear-selection\", { content_type: \"Tag\" });\n    }\n  }, {\n    key: \"deleteItem\",\n    value: function deleteItem(item, callback) {\n      this.deleteItems([item], callback);\n    }\n  }, {\n    key: \"deleteItems\",\n    value: function deleteItems(items, callback) {\n      var params = {\n        items: items.map(function (item) {\n          return this.jsonObjectForItem(item);\n        }.bind(this))\n      };\n\n      this.postMessage(\"delete-items\", params, function (data) {\n        callback && callback(data);\n      });\n    }\n  }, {\n    key: \"sendCustomEvent\",\n    value: function sendCustomEvent(action, data, callback) {\n      this.postMessage(action, data, function (data) {\n        callback && callback(data);\n      }.bind(this));\n    }\n  }, {\n    key: \"saveItem\",\n    value: function saveItem(item, callback) {\n      var skipDebouncer = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n      this.saveItems([item], callback, skipDebouncer);\n    }\n\n    /* Presave allows clients to perform any actions last second before the save actually occurs (like setting previews).\n       Saves debounce by default, so if a client needs to compute a property on an item before saving, it's best to\n       hook into the debounce cycle so that clients don't have to implement their own debouncing.\n     */\n\n  }, {\n    key: \"saveItemWithPresave\",\n    value: function saveItemWithPresave(item, presave, callback) {\n      this.saveItemsWithPresave([item], presave, callback);\n    }\n  }, {\n    key: \"saveItemsWithPresave\",\n    value: function saveItemsWithPresave(items, presave, callback) {\n      this.saveItems(items, callback, false, presave);\n    }\n\n    /*\n    skipDebouncer allows saves to go through right away rather than waiting for timeout.\n    This should be used when saving items via other means besides keystrokes.\n     */\n\n  }, {\n    key: \"saveItems\",\n    value: function saveItems(items, callback) {\n      var _this3 = this;\n\n      var skipDebouncer = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n      var presave = arguments[3];\n\n      var saveBlock = function saveBlock() {\n        // presave block allows client to gain the benefit of performing something in the debounce cycle.\n        presave && presave();\n\n        var mappedItems = items.map(function (item) {\n          item.updated_at = new Date();\n          return this.jsonObjectForItem(item);\n        }.bind(_this3));\n\n        _this3.postMessage(\"save-items\", { items: mappedItems }, function (data) {\n          callback && callback();\n        });\n      };\n\n      /*\n        Coallesed saving prevents saves from being made after every keystroke, and instead\n        waits coallesedSavingDelay before performing action. For example, if a user types a keystroke, and the clienet calls saveItem,\n        a 250ms delay will begin. If they type another keystroke within 250ms, the previously pending\n        save will be cancelled, and another 250ms delay occurs. If ater 250ms the pending delay is not cleared by a future call,\n        the save will finally trigger.\n         Note: it's important to modify saving items updated_at immediately and not after delay. If you modify after delay,\n        a delayed sync could just be wrapping up, and will send back old data and replace what the user has typed.\n      */\n      if (this.coallesedSaving == true && !skipDebouncer) {\n        if (this.pendingSave) {\n          clearTimeout(this.pendingSave);\n        }\n\n        this.pendingSave = setTimeout(function () {\n          saveBlock();\n        }, this.coallesedSavingDelay);\n      } else {\n        saveBlock();\n      }\n    }\n  }, {\n    key: \"jsonObjectForItem\",\n    value: function jsonObjectForItem(item) {\n      var copy = Object.assign({}, item);\n      copy.children = null;\n      copy.parent = null;\n      return copy;\n    }\n  }, {\n    key: \"getItemAppDataValue\",\n    value: function getItemAppDataValue(item, key) {\n      var AppDomain = \"org.standardnotes.sn\";\n      var data = item.content.appData && item.content.appData[AppDomain];\n      if (data) {\n        return data[key];\n      } else {\n        return null;\n      }\n    }\n\n    /* Themes */\n\n  }, {\n    key: \"activateThemes\",\n    value: function activateThemes(incomingUrls) {\n      if (this.loggingEnabled) {\n        console.log(\"Incoming themes\", incomingUrls);\n      }\n      if (this.activeThemes.sort().toString() == incomingUrls.sort().toString()) {\n        // incoming are same as active, do nothing\n        return;\n      }\n\n      var themesToActivate = incomingUrls || [];\n      var themesToDeactivate = [];\n\n      var _iteratorNormalCompletion2 = true;\n      var _didIteratorError2 = false;\n      var _iteratorError2 = undefined;\n\n      try {\n        for (var _iterator2 = this.activeThemes[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n          var activeUrl = _step2.value;\n\n          if (!incomingUrls.includes(activeUrl)) {\n            // active not present in incoming, deactivate it\n            themesToDeactivate.push(activeUrl);\n          } else {\n            // already present in active themes, remove it from themesToActivate\n            themesToActivate = themesToActivate.filter(function (candidate) {\n              return candidate != activeUrl;\n            });\n          }\n        }\n      } catch (err) {\n        _didIteratorError2 = true;\n        _iteratorError2 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion2 && _iterator2.return) {\n            _iterator2.return();\n          }\n        } finally {\n          if (_didIteratorError2) {\n            throw _iteratorError2;\n          }\n        }\n      }\n\n      if (this.loggingEnabled) {\n        console.log(\"Deactivating themes:\", themesToDeactivate);\n        console.log(\"Activating themes:\", themesToActivate);\n      }\n\n      var _iteratorNormalCompletion3 = true;\n      var _didIteratorError3 = false;\n      var _iteratorError3 = undefined;\n\n      try {\n        for (var _iterator3 = themesToDeactivate[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n          var theme = _step3.value;\n\n          this.deactivateTheme(theme);\n        }\n      } catch (err) {\n        _didIteratorError3 = true;\n        _iteratorError3 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion3 && _iterator3.return) {\n            _iterator3.return();\n          }\n        } finally {\n          if (_didIteratorError3) {\n            throw _iteratorError3;\n          }\n        }\n      }\n\n      this.activeThemes = incomingUrls;\n\n      var _iteratorNormalCompletion4 = true;\n      var _didIteratorError4 = false;\n      var _iteratorError4 = undefined;\n\n      try {\n        for (var _iterator4 = themesToActivate[Symbol.iterator](), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {\n          var url = _step4.value;\n\n          if (!url) {\n            continue;\n          }\n\n          var link = document.createElement(\"link\");\n          link.id = btoa(url);\n          link.href = url;\n          link.type = \"text/css\";\n          link.rel = \"stylesheet\";\n          link.media = \"screen,print\";\n          link.className = \"custom-theme\";\n          document.getElementsByTagName(\"head\")[0].appendChild(link);\n        }\n      } catch (err) {\n        _didIteratorError4 = true;\n        _iteratorError4 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion4 && _iterator4.return) {\n            _iterator4.return();\n          }\n        } finally {\n          if (_didIteratorError4) {\n            throw _iteratorError4;\n          }\n        }\n      }\n    }\n  }, {\n    key: \"themeElementForUrl\",\n    value: function themeElementForUrl(url) {\n      var elements = Array.from(document.getElementsByClassName(\"custom-theme\")).slice();\n      return elements.find(function (element) {\n        // We used to search here by `href`, but on desktop, with local file:// urls, that didn't work for some reason.\n        return element.id == btoa(url);\n      });\n    }\n  }, {\n    key: \"deactivateTheme\",\n    value: function deactivateTheme(url) {\n      var element = this.themeElementForUrl(url);\n      if (element) {\n        element.disabled = true;\n        element.parentNode.removeChild(element);\n      }\n    }\n\n    /* Theme caching is currently disabled. Might be enabled in the future if neccessary. */\n    /*\n    activateCachedThemes() {\n      let themes = this.getCachedThemeUrls();\n      let writeToCache = false;\n      if(this.loggingEnabled) { console.log(\"Activating cached themes\", themes); }\n      this.activateThemes(themes, writeToCache);\n    }\n     cacheThemeUrls(urls) {\n      if(this.loggingEnabled) { console.log(\"Caching theme urls\", urls); }\n      localStorage.setItem(\"cachedThemeUrls\", JSON.stringify(urls));\n    }\n     decacheThemeUrls() {\n      localStorage.removeItem(\"cachedThemeUrls\");\n    }\n     getCachedThemeUrls() {\n      let urls = localStorage.getItem(\"cachedThemeUrls\");\n      if(urls) {\n        return JSON.parse(urls);\n      } else {\n        return [];\n      }\n    }\n    */\n\n    /* Utilities */\n\n  }, {\n    key: \"generateUUID\",\n    value: function generateUUID() {\n      var crypto = window.crypto || window.msCrypto;\n      if (crypto) {\n        var buf = new Uint32Array(4);\n        crypto.getRandomValues(buf);\n        var idx = -1;\n        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n          idx++;\n          var r = buf[idx >> 3] >> idx % 8 * 4 & 15;\n          var v = c == 'x' ? r : r & 0x3 | 0x8;\n          return v.toString(16);\n        });\n      } else {\n        var d = new Date().getTime();\n        if (window.performance && typeof window.performance.now === \"function\") {\n          d += performance.now(); //use high-precision timer if available\n        }\n        var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n          var r = (d + Math.random() * 16) % 16 | 0;\n          d = Math.floor(d / 16);\n          return (c == 'x' ? r : r & 0x3 | 0x8).toString(16);\n        });\n        return uuid;\n      }\n    }\n  }]);\n\n  return ComponentManager;\n}();\n\nif (typeof module != \"undefined\" && typeof module.exports != \"undefined\") {\n  module.exports = ComponentManager;\n}\n\nif (window) {\n  window.ComponentManager = ComponentManager;\n}\n//# sourceMappingURL=dist.js.map\n;'use strict';\n\nangular.module('app', [\n\n])\n;class HomeCtrl {\n  constructor($rootScope, $scope, $timeout) {\n\n    let smartTagContentType = \"SN|SmartTag\";\n\n    let componentManager = new window.ComponentManager([], () => {\n      // on ready\n      $rootScope.platform = componentManager.platform;\n    });\n\n    let delimiter = \".\";\n\n    $scope.resolveRawTags = function(masterTag) {\n      let sortTags = (tags) => {\n        return tags.sort((a, b) => (a.content.title > b.content.title) - (a.content.title < b.content.title));\n      }\n      var resolved = masterTag.rawTags.slice();\n\n      var findResolvedTag = function(title) {\n        for(var tag of masterTag.rawTags) {\n          if(tag.content.title === title) {\n            return tag;\n          }\n        }\n        return null;\n      }\n\n      for(var tag of masterTag.rawTags) {\n        var pendingDummy = tag.children && tag.children.find((c) => {return c.dummy});\n        tag.children = [];\n        tag.parent = null;\n\n        if(pendingDummy) {\n          tag.children.unshift(pendingDummy);\n        }\n      };\n\n      for(var tag of masterTag.rawTags) {\n        var name = tag.content.title;\n        var comps = name.split(delimiter);\n        tag.displayTitle = comps[comps.length -1];\n        if(comps.length == 1) {\n          tag.parent = masterTag;\n          continue;\n        }\n\n        var getParent = function(depth = 1) {\n          var parentTitle = comps.slice(0, comps.length - depth).join(delimiter);\n          if(parentTitle.length == 0) {\n            return null;\n          }\n          var parent = findResolvedTag(parentTitle);\n\n          // didn't find parent, try again.\n          // just make sure we're not deeper in search than we can go\n          if(!parent && depth < comps.length - 1) {\n            return getParent(depth + 1);\n          }\n\n          // remove parent from name and keep this full tag name to display\n          var tagTitle = tag.content.title.slice(parentTitle.length+1);\n          tag.displayTitle = tagTitle;\n\n          return parent;\n        };\n\n        var parent = getParent();\n\n        // no parent at all up the tree, fall back to root with full name\n        if(!parent) {\n          tag.displayTitle = tag.content.title;\n          tag.parent = masterTag;\n          continue;\n        }\n\n        parent.children.push(tag);\n        parent.children = sortTags(parent.children);\n        tag.parent = parent;\n\n        // remove chid from master list\n        var index = resolved.indexOf(tag);\n        resolved.splice(index, 1);\n\n        if($scope.selectedTag && $scope.selectedTag.uuid == tag.uuid) {\n          $scope.selectedTag = tag;\n          $scope.setSelectedForTag(tag, true);\n        }\n      }\n\n      var pendingDummy = masterTag.children && masterTag.children.find((c) => {return c.dummy});\n      masterTag.children = sortTags(resolved);\n      if(pendingDummy) { masterTag.children.unshift(pendingDummy); }\n    }\n\n    $scope.changeParent = function(sourceId, targetId) {\n      var source = $scope.masterTag.rawTags.filter(function(tag){\n        return tag.uuid === sourceId;\n      })[0];\n\n      var target = targetId === \"0\" ? $scope.masterTag : $scope.masterTag.rawTags.filter(function(tag){\n        return tag.uuid === targetId;\n      })[0];\n\n      if(target.parent === source) {\n        return;\n      }\n\n      var needsSave = [source];\n\n      var adjustChildren = function(source) {\n        for(var child of source.children) {\n          var newTitle = source.content.title + delimiter + child.content.title.split(delimiter).slice(-1)[0];\n          child.content.title = newTitle;\n          needsSave.push(child);\n          adjustChildren(child);\n        }\n      }\n\n      var newTitle;\n      if(target.master) {\n        newTitle = source.content.title.split(delimiter).slice(-1)[0];\n      } else {\n        newTitle = target.content.title + delimiter + source.content.title.split(delimiter).slice(-1)[0];\n      }\n      source.content.title = newTitle;\n      adjustChildren(source);\n      $scope.resolveRawTags($scope.masterTag);\n\n      componentManager.saveItems(needsSave);\n    }\n\n    $scope.createTag = function(tag) {\n      var title = tag.content.title;\n      if(title.startsWith(\"![\")) {\n        // Create smart tag\n        /*\n        ![\"Untagged\", \"tags.length\", \"=\", 0]\n        ![\"B-tags\", \"tags\", \"includes\", [\"title\", \"startsWith\", \"b\"]]\n        ![\"Foo Notes\", \"title\", \"startsWith\", \"Foo\"]\n        ![\"Archived\", \"archived\", \"=\", true]\n        ![\"Pinned\", \"pinned\", \"=\", true]\n        ![\"Not Pinned\", \"pinned\", \"=\", false]\n        ![\"Last Day\", \"updated_at\", \">\", \"1.days.ago\"]\n        ![\"Long\", \"text.length\", \">\", 500]\n        */\n        try {\n          var components = JSON.parse(title.substring(1, title.length));\n        } catch (e) {\n          alert(\"There was an error parsing your smart tag syntax. Please ensure the value after the exclamation mark is valid JSON, and try again.\")\n          return;\n        }\n        var smartTag = {\n          content_type: smartTagContentType,\n          content: {\n            title: components[0],\n            predicate: {\n              keypath: components[1],\n              operator: components[2],\n              value: components[3]\n            }\n          }\n        }\n        componentManager.createItem(smartTag, (createdTag) => {\n          // We don't want to select the tag right away because it hasn't been added yet.\n          // If you do $scope.selectTag(createdTag), an issue occurs where selecting another tag\n          // after that will not dehighlight this one.\n          $scope.selectOnLoad = createdTag;\n        });\n      } else {\n        tag.content_type = \"Tag\";\n        var title;\n        if(tag.parent.master) {\n          title = tag.content.title;\n        } else {\n          title = tag.parent.content.title + delimiter + tag.content.title;\n        }\n        tag.content.title = title;\n        tag.dummy = false;\n        componentManager.createItem(tag, (createdTag) => {\n          $scope.selectOnLoad = createdTag;\n        });\n      }\n    }\n\n    $scope.selectTag = function(tag, multiSelect) {\n      let isSmartTag = tag.content_type == smartTagContentType;\n      // Multi selection for smart tags is not possible.\n      if(isSmartTag) {\n        multiSelect = false;\n      }\n\n      let clearMultipleTagsSelection = function() {\n        if($scope.multipleTags) {\n          for(var selectedTag of $scope.multipleTags) {\n            $scope.setSelectedForTag(selectedTag, false);\n          }\n        }\n      }\n\n      if(tag.master || tag.smartMaster) {\n        clearMultipleTagsSelection();\n        $scope.multipleTags = [];\n        componentManager.clearSelection();\n      } else {\n        if(!$scope.multipleTags) { $scope.multipleTags = []; }\n        if(!isSmartTag) {\n          $scope.multipleTags.push(tag);\n        }\n        if(multiSelect && $scope.multipleTags.length > 1) {\n          var smartTag = $scope.createEphemeralSmartTagForMultiTags();\n          componentManager.selectItem(smartTag);\n        } else {\n          clearMultipleTagsSelection();\n          $scope.multipleTags = isSmartTag ? [] : [tag];\n          componentManager.selectItem(tag);\n        }\n      }\n\n      // if multiselect, we don't want to clear selected tag. But if master is selected,\n      // and multi select other tag, we do want to clear master. Rather than creating a large if\n      // statement, we'll just an if else.\n\n      if(!multiSelect && $scope.selectedTag && $scope.selectedTag != tag) {\n        $scope.setSelectedForTag($scope.selectedTag, false);\n        $scope.selectedTag.editing = false;\n      } else if($scope.selectedTag.master || $scope.selectedTag.smartMaster || $scope.selectedTag.content_type == smartTagContentType) {\n        $scope.setSelectedForTag($scope.selectedTag, false);\n      }\n\n      if($scope.selectedTag === tag && !tag.master) {\n        tag.editing = true;\n      }\n\n      $scope.selectedTag = tag;\n      $scope.setSelectedForTag(tag, true);\n    }\n\n    $scope.createEphemeralSmartTagForMultiTags = function() {\n      let smartTag = {\n        uuid: Math.random(),\n        content_type: \"SN|SmartTag\",\n        content: {\n          title: \"Multiple tags\"\n        }\n      }\n\n      var tagNames = $scope.multipleTags.map((tag) => {return tag.content.title});\n      var predicate = [\"tags\", \"includes\", [\"title\", \"in\", tagNames]];\n      smartTag.content.predicate = predicate;\n      return smartTag;\n    }\n\n    $scope.toggleCollapse = function(tag) {\n      tag.clientData.collapsed = !tag.clientData.collapsed;\n      if(!tag.master) {\n        componentManager.saveItem(tag);\n      }\n    }\n\n    $scope.saveTags = function(tags) {\n      componentManager.saveItems(tags);\n    }\n\n    $scope.setSelectedForTag = function(tag, selected) {\n      tag.selected = selected;\n    }\n\n    componentManager.streamItems([\"Tag\", smartTagContentType], (newTags) => {\n      $timeout(() => {\n        var allTags = $scope.masterTag ? $scope.masterTag.rawTags : [];\n        var smartTags = $scope.smartMasterTag ? $scope.smartMasterTag.rawTags : [];\n        for(var tag of newTags) {\n          var isSmartTag = tag.content_type == smartTagContentType;\n          var arrayToUse = isSmartTag ? smartTags : allTags;\n\n          var existing = arrayToUse.filter((tagCandidate) => {\n            return tagCandidate.uuid === tag.uuid;\n          })[0];\n\n          if(existing) {\n            Object.assign(existing, tag);\n          } else if(tag.content.title) {\n            arrayToUse.push(tag);\n          }\n\n          if(tag.deleted) {\n            var index = arrayToUse.indexOf(existing || tag);\n            arrayToUse.splice(index, 1);\n          } else {\n            if($scope.selectOnLoad && $scope.selectOnLoad.uuid == tag.uuid)  {\n              $scope.selectOnLoad = null;\n              $scope.selectTag(tag);\n            } else if(existing && $scope.selectedTag.uuid == existing.uuid) {\n              // Don't call $scope.selectTag(existing) as this will double select a tag, which will enable editing for it.\n              $scope.setSelectedForTag(existing, true);\n            }\n          }\n        }\n\n        if(!$scope.masterTag) {\n          $scope.masterTag = {\n            master: true,\n            content: {\n              title: \"\"\n            },\n            displayTitle: \"All\",\n            uuid: \"0\",\n            clientData: {}\n          }\n        }\n\n        if(!$scope.smartMasterTag) {\n          $scope.smartMasterTag = {\n            master: true,\n            smartMaster: true,\n            content: {\n              title: \"\"\n            },\n            displayTitle: \"Views\",\n            uuid: \"1\",\n            clientData: {}\n          }\n        }\n\n        $scope.masterTag.rawTags = allTags;\n        $scope.smartMasterTag.rawTags = smartTags;\n\n        if(!$scope.selectedTag || ($scope.selectedTag && $scope.selectedTag.master)) {\n          if($scope.selectedTag && $scope.selectedTag.smartMaster) {\n            $scope.selectedTag = $scope.smartMasterTag;\n            $scope.setSelectedForTag($scope.masterTag, false);\n          } else {\n            $scope.selectedTag = $scope.masterTag;\n            $scope.setSelectedForTag($scope.smartMasterTag, false);\n          }\n          $scope.setSelectedForTag($scope.selectedTag, true);\n        }\n\n        if($scope.selectedTag.deleted) {\n          $scope.selectTag($scope.masterTag);\n        }\n\n        $scope.resolveRawTags($scope.masterTag);\n        $scope.resolveRawTags($scope.smartMasterTag);\n      })\n    });\n\n    $scope.deleteTag = function(tag) {\n      var isSmartTag = tag.content_type == smartTagContentType;\n      var arrayToUse = isSmartTag ? $scope.smartMasterTag.rawTags : $scope.masterTag.rawTags;\n\n      var tag = arrayToUse.filter(function(tagCandidate){\n        return tagCandidate.uuid === tag.uuid;\n      })[0];\n\n      var deleteChain = [];\n\n      function addChildren(tag) {\n        deleteChain.push(tag);\n        if(tag.children) {\n          for(var child of tag.children) {\n            addChildren(child);\n          }\n        }\n      }\n\n      addChildren(tag);\n\n      componentManager.deleteItems(deleteChain);\n    }\n  }\n}\n\n// required for firefox\nHomeCtrl.$$ngIsClass = true;\n\nangular.module('app').controller('HomeCtrl', HomeCtrl);\n;angular\n  .module('app')\n  .directive('mbAutofocus', ['$timeout', function($timeout) {\n    return {\n      restrict: 'A',\n      scope: {\n        shouldFocus: \"=\"\n      },\n      link : function($scope, $element) {\n        $timeout(function() {\n          if($scope.shouldFocus) {\n            $element[0].focus();\n          }\n        });\n      }\n    }\n  }]);\n;angular\n  .module('app')\n  .directive('draggable', function() {\n  return  {\n    scope: {\n      tagId: \"=\",\n      drop: '&',\n      isDraggable: \"=\",\n      isDroppable: \"=\"\n    },\n    link: function(scope, element, attrs) {\n      // 'ngInject';\n      var el = element[0];\n\n      el.draggable = scope.isDraggable;\n\n      var counter = 0;\n\n      el.addEventListener(\n        'dragstart',\n        function(e) {\n          counter = 0;\n          e.dataTransfer.effectAllowed = 'move';\n          e.dataTransfer.setData('TagId', JSON.stringify(scope.tagId));\n          this.classList.add('drag');\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'dragend',\n        function(e) {\n          this.classList.remove('drag');\n          this.classList.remove('over');\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'dragover',\n        function(e) {\n          e.dataTransfer.dropEffect = 'move';\n          // allows us to drop\n          if (e.preventDefault) e.preventDefault();\n          if(scope.isDroppable) { this.classList.add('over'); }\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'dragenter',\n        function(e) {\n          counter++;\n          if(scope.isDroppable) { this.classList.add('over'); }\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'dragleave',\n        function(e) {\n          counter--;\n           if (counter === 0) {\n             this.classList.remove('over');\n           }\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'dragexit',\n        function(e) {\n          // counter--;\n          //  if (counter === 0) {\n             this.classList.remove('over');\n          //  }\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'drop',\n        function(e) {\n\n          // Stops some browsers from redirecting.\n          counter = 0;\n          if (e.stopPropagation) e.stopPropagation();\n\n          this.classList.remove('over');\n\n          var targetId = JSON.parse(e.dataTransfer.getData('TagId'));\n          if(targetId === scope.tagId) {\n            return;\n          }\n          scope.$apply(function(scope) {\n            scope.drop()(targetId, scope.tagId);\n          });\n\n          return false;\n        },\n        false\n      );\n\n    }\n  }\n});\n;class TagTree {\n\n  constructor() {\n    this.restrict = \"C\";\n    this.templateUrl = \"directives/tag_tree.html\";\n    this.scope = {\n      tag: \"=\",\n      changeParent: \"&\",\n      onSelect: \"&\",\n      createTag: \"&\",\n      saveTags: \"&\",\n      deleteTag: \"&\",\n      onToggleCollapse: \"&\"\n    };\n  }\n\n  controller($scope, $timeout) {\n    'ngInject';\n\n    $scope.isDraggable = function() {\n      return !$scope.tag.master && $scope.tag.content_type != 'SN|SmartTag';\n    }\n\n    $scope.isDroppable = function() {\n      return !$scope.tag.smartMaster && $scope.tag.content_type != 'SN|SmartTag';\n    }\n\n    $scope.onDrop = function(sourceId, targetId) {\n      $scope.changeParent()(sourceId, targetId);\n    }\n\n    $scope.onDragOver = function(event) {\n\n    }\n\n    $scope.onDragStart = function(event) {\n\n    }\n\n    $scope.selectTag = function(event) {\n      let multiSelect = event.ctrlKey || event.metaKey;\n      $scope.onSelect()($scope.tag, multiSelect);\n    }\n\n    $scope.addChild = function($event, parent) {\n      $event.stopPropagation();\n      var addingTag = {dummy: true, parent: parent, content: {title: \"\"}};\n      parent.children.unshift(addingTag);\n    }\n\n    $scope.saveNewTag = function(tag) {\n      if(tag.content.title && tag.content.title.length > 0) {\n        $scope.createTag()(tag);\n      }\n      tag.parent.children.splice(tag.parent.children.indexOf(tag), 1);\n    }\n\n    $scope.removeTag = function(tag) {\n      $scope.deleteTag()(tag);\n    }\n\n    $scope.innerCollapse = function(tag) {\n      if($scope.onToggleCollapse()) {\n        $scope.onToggleCollapse()(tag);\n      }\n    }\n\n    $scope.saveTagRename = function(tag) {\n      if(!tag.displayTitle || tag.displayTitle.length == 0) {\n        // Delete\n        $scope.deleteTag()(tag);\n        return;\n      }\n      var delimiter = \".\";\n      var tags = [tag];\n      var title;\n      if(tag.parent.master) {\n        title = tag.displayTitle;\n      } else {\n        title = tag.parent.content.title + delimiter + tag.displayTitle;\n      }\n\n      tag.content.title = title;\n\n      function renameChildren(tag) {\n        for(var child of tag.children) {\n          child.content.title = child.parent.content.title + delimiter + child.displayTitle;\n          tags.push(child);\n          renameChildren(child);\n        }\n      }\n\n      renameChildren(tag);\n\n      tag.editing = false;\n\n      $scope.saveTags()(tags);\n    }\n\n    $scope.generationForTag = function(tag) {\n      var generation = 0;\n      var parent = tag.parent;\n      while(parent) {\n        generation++;\n        parent = parent.parent;\n      }\n\n      return generation;\n    }\n\n    $scope.circleClassForTag = function(tag) {\n      if(tag.content_type == \"SN|SmartTag\") {\n        return \"success\";\n      }\n\n      // is newly creating tag\n      if(!tag.uuid) {\n        return \"contrast\";\n      }\n\n\n      let gen = $scope.generationForTag(tag);\n      var circleClass = {\n        0: \"info\",\n        1: \"info\",\n        2: \"success\",\n        3: \"danger\",\n        4: \"warning\",\n      }[gen];\n\n      if(!circleClass) {\n        circleClass = \"neutral\";\n      }\n\n      // Newly creating tags don't have client data\n      if(tag.clientData && tag.clientData.collapsed) {\n        circleClass += \" no-bg\";\n      }\n\n      return circleClass;\n    }\n\n  }\n}\n\nTagTree.$$ngIsClass = true;\n\nangular.module('app').directive('tagTree', () => new TagTree);\n"]}